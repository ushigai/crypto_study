from Crypto.Util.number import *


ciphers = [3898223318645204304626552444305804550545422279023832718887940115023896419256308816229011928692515152317735973851898907262805930290445221675592850777214511998646272552904300831625880402658047253649025184731061822286010622529863868673585864217226341785216357304593543302873135588041485320517516663638376477006208267001929846424659685308446378895478121893428353349818137862794191056698579714002849085761576430818565304010571383932746691220701188416301257837117068637354430570290214392619759471876270601077929263137158221081101024951560322927614868097348291883168681000791291389053619013590931535541067323244459244712587, 10889508645850077865217449460925196378558321198293957004700149310468521167673798651601773882076795842865235469736369779973360170811111583804002354939843826625090626387223849032372477307795883122820408235655851359714840337016187166764902590185351760574470542672752703416539006073152377215120644815304604679852468763586738848137531478479395104352567531759277794710205159551273571554634684857936169906888927519721159243822254412362114567259318399288975652014993393812357965200321914418976605416872250748210789358462429947344678528715345689451153976991597005065936441598497635924876729380191193333230101886116563145074366, 6112361614049848027836912701181795858653486471273366341418154908984843757152204060970929967102537297323807617216588583037391330518432361684260013931234767820831626703161955879848062565029917951049004142554966572353411434487632976621775022130697963665759076653444241428931499265095067331746895006963541281423254477976467097094675965647155883696036612560579700620246194194721165036229477598463507853393332362372932617519927592709695185750938044618275534333757785645833341365741744224407217256102562909833680719858170503560575670323807320840101290343543543264556035010227907054426054188862672033810965889488272228395451, 1658088757445068988912675020933395603442282708029301228368707271007420976425633820126717681430526266727896152870296077064886575424640587436436276063974481823940141865859856386634245434895515949282445547709116999460588365248502434951800728684749579904547523985241830391606549770934885955295619850657966908139123568881871118451712542845741824997407816246158510290864425772093290588962628507463956898403666307634766149715957179780029917635864957067244331949174741951115413689493490128436128660573719172492757276251784091819388225013972947626175996352855283126885355674953635854295465211423849586963015489596698374845214, 3045638002318688677439241151164420523840286368421850147614056260293138698746976002815523659943222953573420371189044524843550252199052538100981492887089931286115643916055194264744996619740807783266727814672697515893799067969115068126952796151331953630298765229710800742664330882334466255174600935615615331710790864450141123597929906809410104947959685504199909645915829967722083543025476148013174025697707180486463023227893073327657398540328175436820560325997050275149900951346091431802551477263974211891233375499893814596543823611975123435604839403460308865899477950344620574546003362959298474899372321878947034323080]
A = [97562982547147155776492539344789742439661892646621219076680903986368964440575851919116814137245198937622775023947895458846022049448537375615940244419934565354728094297928582088266523710875125787155484024123105231222186585575067848179280125942029596148411355573845096753754871995209958228751123756364841204030, 127380600791192181623822591118877274272843802169073507359269345577658333723365803731685432768436230349604303899471662842684173064650623972953550282105530617139598355821727521453917452341216751876954844569999467034838150269539465252913085773647095691540617663729688163722637985182192602420864202361082612093238, 48284954373970345599956414052080976389658531302368543661582088141834059718717381129083194229631428149341135294808784552258528855509903203925812144129453358462553176013479460437074127203781328168721140240181156221961484778188627328623209512652268208321322736079684088039348196504402351062907212923459748479372, 38269242104546798629744951978130708909394965749381053017820802135421085073292504921331952130381255287224271714403168365692325835579257639145478730456578731776249276220691982425984566464038191292999273475618087773872864825853773674938433248679663557129997434011449668076661619436142162093265885615948896412151, 22399532644600092966015458356062195700116872910894717497527862258522101188464142939119505275934865579157891095841973167499131289182629474288469666226470959675662660409123167902373653222855007295416190489914988958944818793171790458725985365136059567135684202996081082899571853546959715666107604047726811441834]
B = [101496919015701790991109305425293099379738520656136764787106219531541580908662273462191927354102749703637407916739649855062888655183060290852820546853284192281821145522531836625173319471547386789065135145831513006103390645307272831698714430105649474067695777602806504266622080638494635328193415517238128374639, 88741191849597289546451038551346433550625020337587576415515164463113265698518603226634659065441310036502682500479576835859748078371562690401894357720018746417853705474571542436273463319380237699029260989839471679462276154632071389328498156980411387944625272758132569608151583633567517667386886450965669874133, 3565924310814355457071753101075514913347855045804422641075693858629180034259746378771274274548630475682464425780102457143824005411953670590461096498707307749084928550046525977381779009225954567725531390844484979410214934621402743603116604416131605541223509300927246342448793449305791877396907807557733086102, 15332694381178380085202144829522039523544049594860523269677978774575932886176905294527555379029356538489808090081560268856783216683567389304674251725578398604956482439053335017375171413409678608701429167038378285055991876237406535211890766476887721714137384581786694056758186968596605382717005711563910027309, 15288558513111669620286860848197757605585427110967356773425883077550828443638774918150299979381212134825090418537590647337096798212787968161635185227993427210456409107940531419063196142368830952777454624751139167323477395451261811365212032304121547073786017993602862919407540499000870472319655019339472925638]
N = [20364478227477174114116582735034133869455474659394886077386615627297788460527911010716379046147925965890816426704478693075852576375439862300871536549391362593800363175278815627203368191869496013517998006085641009548004531508357043746558312656327655653797810405483721368147359794256514309909149123757398472154999607054235481366062792057299453887598811842607994643724640921357105663311148497686073858513094147344299249949315371751163550602282758713740289909027084520802140170146133800744824619868341744162964832412899346532451222347425387597116395076487263064819940846391902592614664022657590184835845043306822394769841, 11560829401349207827544372840859969734978414149230306119482848856804328006096596018880263748581605656930292179782919934454862702678322834926923936736625127921304812567257193465771898165027107323049660335088525650845871474787818748093697759561056435387205772087558320503376780490657129610593882950823322931099723573825326865205881924212033587580532041445195461954387417163599856067654001865248327153247511430353665252262565339593102684076891522864282048603151895090481096456015881417526674682003267476230775287006169566971477460660637125691670436209838486532759632004166824994017197968072360466778498875203013245868707, 20517822172448546950887031497475327152865068124160311288780953561010457455073784934645502700256178877918289476811705037766298841534803669153644970796018110835441354824571434117962506314389709009227521078117609971609359419981378904305092019781588659416242588852167855120493473006526674020184075710803459220505249929596816360364958294011024827855251720832755186362501686453992093672889470856702829451107731491491711666482162358149313412706750071075670974850706202543067078487381332653796117726971170367354441940851453568862024604754140063696259091837833429005746344419793940762646463706281008110692540914826323478874289, 17786303571896188354826288126757774923764792608510275015897557116521411010627898069573537928149662285148820437822820724823332648011527452154923539458429578987288192682700819258799203826175011027974889065134639449026582414109443009013969559156408326472391681223528794811229900655810339282157978136423698433908554661293867629045749687456195384155365844485482199046481533636037477096431515991644364420163613722305375506903500677461052152512138381543615772207224338794802275212550693174155247395403500303275774068803837291227206210316601548605012424921145941483929895903997509851447024887412516064506843987234425278523007, 21149966648127303129069325261449268711997247854778063271858175795451952297167638994178083122922531578047186042618913672920333623162406421147076198212634204558627207786254678395242180915431480735968084642628806457986144525125397092264175799122411815001850341956071015445264716895513772810474424942437378474014564885838278093100544356040849936968711673097913715141491077114078911443135084479767891596349985970128069119665219310652319731986972530690887724794021788198901180236942976617054479259101686208824757113632691180079544280721256989982544268498512971919528359286543040954052652190591568482848348351352318750943191]


a1 = 69083553146183344839772978505267712546348345951915552104934666999364893606414967631473531356169090286677897220956536147203986323670778671853966574104550916190831974039291113434428713226539656233005536401237618731903013444912424490954403050283261443145833828774338405850464149745370010921929208582803372719662
a2 = 27025595670607123748133955387986761928986723842407963667833744851457582823949409825451502999363014637018266381381800334740959357732693327871649715849440610655814448606276225985636706847320729571129651265791968308846145775455134446011658371731137714821594128627843120134392299295278193619998726010683820300906
a3 = 3004029671513060545517047598385797934912754972599429487078366757715733246340760740484289209221138121568405251845847578856114711659946228365274190780159966913357682874178318970562635144717761245951754408952773122354583612422645258507146795630561366955268226048296864853067903656400207186949463324893914485565
a4 = 42305211872257990504112591982462712826623117527580306258621876854892728665082535381823460722212076449810881809439537932537619270097066694079814712136330261508201872405339882571623217945205024525421229411985020496914748229102523658456972139082089291624782533401385935487411288676903751198610145921301518231107
a5 = 35798442949372217448131245718267683892608947365147471016957781854054771928382329233065506241624702265207177594187978141208820788381204095301540789196845409818326829309725267401115274448449544207730582441399296587733377747658506089439891602945020732454221665678849354836056443444544603686977883511757122333808

b1 = 1847353606880715823527099792264841437499256859046112182901817731898583109812226034453486290034759426343181112477498401843027934563915568068662901070357638240406212287869791959600724393823543974271939728800168160170264361943043888105413027223078955278440961637038127459036967868261370295558665462738851664674
b2 = 76626521446699164152465241536023395842467420530412705255543098462161399927889232797875074266701010280661667851769988806969262190694662659916308198862288454347865777843483804317714263754964326435968683758707252482706186266157923587034286069745922345373717550980870551177895535541280767243258161167226140529179
b3 = 39916349286626463801197107509708900778499859478703695888378041406302001988773262878930035955207487249221227735861868182215434820807844055889132141226547303138247159556705455695270756436706739886462479337109843197568024375533105139465029460850504284879314129902197486373473299170494478698741715992027042335920
b4 = 37927948227203538741746385301195518552457676697015260677758470292294745311488915679784285945487731017142600921756814455642818173556814139042013977633776585763163271296255014647248684364947573160457459801483696377003575286309739820627536302900476424058673287304085337544422656511271366685116274814463373028939
b5 = 15148604454321045616017299717211628700774278430049633748723698755621714384646643282913626328387905917563070000934175316190944226369346680779250458706206743862204417104832969982264440206554850551723416393459529398494316425018200651517022177685036277113534264161058597282135279496222169055121895473052233762246

c1 = 13924397671629169794872532654354896735104301636897981275021597449713744312702850679542667853889775700566291452624971794825605462609659305736119167763171202028684488729179106128850062049316631850373987498751231054904292395688010798166991604433834113228237987911867991301264314792383410544657232986272138720776
c2 = 74820001900443652318294067181707795319993357148314983190736617977547527951708569170206478241294503335669164830735894900549009883421968340647253048091278584463455833751347773269310148496440204410893225151858930449694234125324321395015257722229646579662704510552084383728048226410232141635889320648460673299335
c3 = 14108999386222915459940913638433135402751523880380098398237968303803785854582535395117824943688282642164021530817702254201291805032640778641839809162886268856556652703619578965302291774447936003759868066323907388148146727752981125365333046242305065445858381847752308536916145502431706840471314490470498925933
c4 = 29808378278310626950656040722768610557513777159495566134112105939237344988328390169388824486265334935284692186547128505302437631500267072936205473588904993250984366335171085215776781494184026623681600861765081754836053424849422843633084928107942855476866942904060229897408614881375916806167293356422910088562
c5 = 90847039947327313643774540191254303763104502856236195148227169238729840332433440088244863054796973078431673232305152421572163200464861625035107176753552370732936207870756803675490237581973525804663863823181351604257906567409397759543713937699041851977124940235865938476195092603195522703292454934101412022811

n1 = 107176667955056054888106289112863406099193890480114548290390156586316295797860714447523894766296345238663487884525751440074160698573876676529510120482633305843604033670838833224316621039974842663423971964367617383524243164757298543267528648455662196669719411550337416706436014652957797379123891565563380621721
n2 = 116940935524323795130742526994657925027084667081524402264947741484054748546876541534619667289853985612350852220069194599338546449074832255593771931123087798582432365325897386813589970457955530817464044545954375253380129491859158211405510009895941963611340400391118219478974834168088677930751757315159110921841
n3 = 100668102943542293762890526110731145470895119442621421158649868631915746146377966542031367735374167457406299434355768725246104804285632863373024153609404762902208230939718098090168262799174612923680636870557478441319366190063047687786785211877198536555745316733683533528849562416675658775836498023052914901749
n4 = 80450031402201203587730534009338660865222026164984422981250298135548464160260574889923232542563882168618899594606271070764435488631855210441010916420059803623249294290301484880522559794167514055495411717729597100446344174893389277795663285345593590647340104666332031316803275436638414115193469755829893511487
n5 = 93862849424043561789940054837392625966883465717813492561917969675964529083848723311514364070936115132154848096497003118110036719543385624344289211314373383330520240583297483284951457880437389550791045654411987778690675595035123064122359417085803319134114455113012761800931917960807358624095094896528184569953
c1, c2, c3, c4, c5 = ciphers
a1, a2, a3, a4, a5 = A
b1, b2, b3, b4, b5 = B
n1, n2, n3, n4, n5 = N
#N = n1*n2*n3*n4*n5
e = 5

F.<x> = PolynomialRing(Zmod(prod(N)), implementation='NTL')

# Step 1
H = []
for i in range(5):
    h = (A[i]*x + B[i])^e - ciphers[i]
    h *= inverse_mod(int(h.lc()), N[i])
    H.append(h)

# Step 2
"""
h1 *= inverse_mod(int(h1.lc()), n1)
h2 *= inverse_mod(int(h2.lc()), n2)
h3 *= inverse_mod(int(h3.lc()), n3)
h4 *= inverse_mod(int(h4.lc()), n4)
h5 *= inverse_mod(int(h5.lc()), n5)
"""

# Step 3
T = []
for i in range(5):
    mat = [0] * 5
    mat[i] = 1
    t = CRT(mat, N)
    T.append(t)

#print(N)
#print(T, H )
"""
t1 = crt([1, 0, 0, 0, 0], [n1, n2, n3, n4, n5])
t2 = crt([0, 1, 0, 0, 0], [n1, n2, n3, n4, n5])
t3 = crt([0, 0, 1, 0, 0], [n1, n2, n3, n4, n5])
t4 = crt([0, 0, 0, 1, 0], [n1, n2, n3, n4, n5])
t5 = crt([0, 0, 0, 0, 1], [n1, n2, n3, n4, n5])
"""

pol = sum([t * h for t, h in zip(T, H)])
print(pol)

# Step 4 (the Coppersmith method is built-in to Sage)
XX = 2**512
roots = pol.small_roots(XX)
flag = int(roots[0])
#print(hex(flag)[2:-1].decode('hex'))
print(long_to_bytes(int(flag)))
